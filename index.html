<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>이미지 업로드 예제</title>
<style>
  /* CSS 스타일링 코드 */
  .upload-form {
    max-width: 400px;
    margin: 50px auto;
    padding: 20px;
    border: 1px solid #ccc;
    border-radius: 5px;
  }
  .upload-form input[type="file"] {
    margin-bottom: 10px;
  }
  .upload-form button {
    padding: 10px 20px;
    background-color: #007bff;
    color: #fff;
    border: none;
    cursor: pointer;
  }
</style>
</head>
<body>

<div class="upload-form">
  <h2>이미지 업로드</h2>
  <input type="file" id="fileInput">
  <button onclick="uploadImage()">업로드</button>
</div>

<!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getStorage, ref, uploadBytesResumable, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";
  import { getDatabase, ref as dbRef, push, set } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

  // Firebase 설정
  const firebaseConfig = {
    apiKey: "AIzaSyCTiPWdi7utrLe6_jrXao7IlrS36nGgBbc",
    authDomain: "junieham-68b8c.firebaseapp.com",
    projectId: "junieham-68b8c",
    databaseURL: "YOUR_DATABASE_URL",
    storageBucket: "junieham-68b8c.appspot.com",
    messagingSenderId: "106219844062",
    appId: "1:106219844062:web:ed39c52351bb70b03e6d4f",
    measurementId: "G-CRXYV0Z48F"
  };

  // Firebase 초기화
  const app = initializeApp(firebaseConfig);
  const storage = getStorage(app);
  const database = getDatabase(app);

  // 이미지 업로드 함수
  function uploadImage() {
    const fileInput = document.getElementById('fileInput');
    const file = fileInput.files[0];
    
    // 이미지 파일을 Firebase Storage에 업로드
    const storageRef = ref(storage, 'images/' + file.name);
    const uploadTask = uploadBytesResumable(storageRef, file);

    uploadTask.on('state_changed',
      (snapshot) => {
        // 업로드 진행 상태를 모니터링할 수 있습니다.
      },
      (error) => {
        console.error('업로드 에러:', error);
      },
      () => {
        // 업로드가 완료되면 이미지의 다운로드 URL을 가져와서 데이터베이스에 저장합니다.
        getDownloadURL(uploadTask.snapshot.ref).then((downloadURL) => {
          saveImageDataToDatabase(file.name, downloadURL);
        });
      }
    );
  }

  // 데이터베이스에 이미지 정보 저장
  function saveImageDataToDatabase(imageName, imageURL) {
    const imagesRef = ref(database, 'images');
    const newImageRef = push(imagesRef);
    set(newImageRef, {
      name: imageName,
      url: imageURL
    }).then(() => {
      console.log('이미지 정보가 데이터베이스에 저장되었습니다.');
    }).catch((error) => {
      console.error('데이터베이스 에러:', error);
    });
  }
</script>

</body>
</html>

</html>
